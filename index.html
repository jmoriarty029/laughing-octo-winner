<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ðŸ’Œ Grievance Portal</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ec4899">

  <!-- iOS support -->
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body class="min-h-screen bg-gradient-to-br from-pink-50 to-purple-100 text-gray-900">
  <header class="sticky top-0 backdrop-blur bg-white/50 border-b border-white/30">
    <div class="max-w-3xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-2xl font-extrabold text-pink-600">ðŸ’Œ Grievance Portal</h1>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 py-6">
    <!-- Form -->
    <section class="card bg-white p-6 mb-6">
      <h2 class="text-lg font-semibold mb-3 text-pink-700">File a New Grievance</h2>
      <input id="title" class="border rounded-xl px-3 py-2 w-full mb-3" placeholder="Title" />
      <textarea id="details" class="border rounded-xl px-3 py-2 w-full mb-3" rows="3" placeholder="Details (optional)"></textarea>
      <div class="flex gap-2 mb-3">
        <button data-sev="Low" class="sevBtn chip border border-green-300 text-green-700">Low</button>
        <button data-sev="Medium" class="sevBtn chip border border-yellow-300 text-yellow-700">Medium</button>
        <button data-sev="High" class="sevBtn chip border border-red-300 text-red-700">High</button>
      </div>
      <button id="submitBtn" class="w-full px-4 py-2 rounded-xl bg-pink-600 hover:bg-pink-700 text-white font-semibold">
        Submit Grievance
      </button>
    </section>

    <!-- List -->
    <section id="list" class="space-y-3"></section>
  </main>

  <script>
    const lsKey = 'grievances_v1';
    let grievances = JSON.parse(localStorage.getItem(lsKey) || '[]');
    let chosenSeverity = 'Medium';

    const els = {
      title: document.getElementById('title'),
      details: document.getElementById('details'),
      submit: document.getElementById('submitBtn'),
      list: document.getElementById('list')
    };

    document.querySelectorAll('.sevBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        chosenSeverity = btn.dataset.sev;
        document.querySelectorAll('.sevBtn').forEach(b => b.classList.remove('bg-gray-100'));
        btn.classList.add('bg-gray-100');
      });
    });

    function save() {
      localStorage.setItem(lsKey, JSON.stringify(grievances));
      render();
    }

    function render() {
      els.list.innerHTML = '';
      if (grievances.length === 0) {
        els.list.innerHTML = '<div class="text-center text-gray-500">No grievances yet ðŸ˜‡</div>';
        return;
      }
      grievances.sort((a,b) => b.created - a.created).forEach(g => {
        const div = document.createElement('div');
        div.className = 'card bg-white p-4';
        div.innerHTML = `
          <div class="flex items-start justify-between">
            <div>
              <h3 class="text-lg font-semibold text-pink-700">${g.title}</h3>
              ${g.details ? `<p class="text-sm text-gray-700 mt-1">${g.details}</p>` : ''}
              <p class="chip mt-2 ${
                g.severity==='High' ? 'bg-red-100 text-red-700 border border-red-200' :
                g.severity==='Medium' ? 'bg-yellow-100 text-yellow-700 border border-yellow-200' :
                'bg-green-100 text-green-700 border border-green-200'
              }">${g.severity} severity</p>
            </div>
            ${g.status!=='Resolved'
              ? `<button data-act="resolve" data-id="${g.id}" class="px-3 py-1 rounded-lg bg-green-600 hover:bg-green-700 text-white text-sm">Resolve</button>`
              : `<button data-act="reopen" data-id="${g.id}" class="px-3 py-1 rounded-lg bg-yellow-600 hover:bg-yellow-700 text-white text-sm">Reopen</button>`}
          </div>
        `;
        div.addEventListener('click', e => {
          const btn = e.target.closest('button');
          if (!btn) return;
          const id = Number(btn.dataset.id);
          if (btn.dataset.act==='resolve') {
            grievances = grievances.map(x=>x.id===id?{...x,status:'Resolved'}:x);
            save();
          } else if (btn.dataset.act==='reopen') {
            grievances = grievances.map(x=>x.id===id?{...x,status:'Filed'}:x);
            save();
          }
        });
        els.list.appendChild(div);
      });
    }

    els.submit.addEventListener('click', () => {
      const title = els.title.value.trim();
      if (!title) { alert('Enter a grievance title'); return; }
      grievances.push({
        id: Date.now(),
        title,
        details: els.details.value.trim(),
        severity: chosenSeverity,
        status: 'Filed',
        created: Date.now()
      });
      els.title.value = '';
      els.details.value = '';
      chosenSeverity = 'Medium';
      save();
    });

    render();

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
